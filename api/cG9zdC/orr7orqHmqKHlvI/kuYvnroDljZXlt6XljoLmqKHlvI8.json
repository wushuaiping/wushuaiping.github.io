{"title":"设计模式之简单工厂模式","date":"2018-03-11T06:43:00.000Z","slug":"设计模式之简单工厂模式","comments":true,"tags":["设计模式"],"updated":"2019-05-11T17:13:37.646Z","content":"<h1 id=\"工厂模式\">工厂模式<a href=\"post/设计模式之简单工厂模式#工厂模式\"></a></h1><ul>\n<li>告诉工厂类，我需要什么，工厂类就会为我提供什么；工厂模式就是典型的面向接口编程，最大化的降低了编码的耦合性。<h2 id=\"简单工厂模式\"><a href=\"#简单工厂模式\" class=\"headerlink\" title=\"简单工厂模式\"></a>简单工厂模式</h2>简单工厂模式比较简单，也是项目中可能会经常用到的一种设计模式。比如，我们在开发时，我们会有不同的库，比如：线下开发环境数据库，预发环境数据库，生产环境数据库。如果不通过工厂模式，我们每次切换环境时，都需要手动改动相关的数据库连接代码，此时代码就产生了严重的耦合。而我们使用简单工厂模式，就可以极大的降低这种耦合，编写的代码如下：</li>\n</ul>\n<blockquote>\n<p>定义一个连接数据库的接口</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  定义一个连接数据库的接口。</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wushuaiping</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2018/3/11 下午2:09</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">DatabaseConnection</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  连接数据库。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">connection</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>再编写不同环境的数据库连接代码实现它</p>\n<blockquote>\n<p>连接线下环境数据库的实现类<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  连接线下环境数据库</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wushuaiping</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2018/3/11 下午2:34</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DailyConnection</span> <span class=\"keyword\">implements</span> <span class=\"title\">DatabaseConnection</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">connection</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这里是连接线下数据库的相关逻辑</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"日常环境连接成功...\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>连接预发环境数据库的实现类<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  连接预发环境数据库</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wushuaiping</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2018/3/11 下午2:39</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PreConnection</span> <span class=\"keyword\">implements</span> <span class=\"title\">DatabaseConnection</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">connection</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 连接预发环境数据库的逻辑代码</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"预发环境连接成功...\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>连接线上环境数据库的实现类<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 连接线上环境数据库</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wushuaiping</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2018/3/11 下午2:42</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProConnection</span> <span class=\"keyword\">implements</span> <span class=\"title\">DatabaseConnection</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">connection</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 连接线上环境数据库的逻辑</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"线上环境连接成功...\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">`</span><br><span class=\"line\">&gt; &gt;编写一个工厂类</span><br><span class=\"line\">```java</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 数据库环境选择工厂类</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wushuaiping</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2018/3/11 下午2:43</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConnectionFactory</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String ENV = <span class=\"string\">\"env\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String PRE = <span class=\"string\">\"pre\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String PRO = <span class=\"string\">\"pro\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 选择连接数据库</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> env</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true: 连接成功</span></span><br><span class=\"line\"><span class=\"comment\">     *         false: 连接未成功</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">connection</span><span class=\"params\">(String env)</span></span>&#123;</span><br><span class=\"line\">        DatabaseConnection databaseConnection;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ENV.equals(env))&#123;</span><br><span class=\"line\">                databaseConnection = <span class=\"keyword\">new</span> DailyConnection();</span><br><span class=\"line\">                databaseConnection.connection();</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (PRE.equals(env))&#123;</span><br><span class=\"line\">                databaseConnection = <span class=\"keyword\">new</span> PreConnection();</span><br><span class=\"line\">                databaseConnection.connection();</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (PRO.equals(env))&#123;</span><br><span class=\"line\">                databaseConnection = <span class=\"keyword\">new</span> ProConnection();</span><br><span class=\"line\">                databaseConnection.connection();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>Test Case<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ConnectionFactory factory = <span class=\"keyword\">new</span> ConnectionFactory();</span><br><span class=\"line\">        <span class=\"comment\">// 日常</span></span><br><span class=\"line\">        factory.connection(ConnectionFactory.ENV);</span><br><span class=\"line\">        <span class=\"comment\">// 预发</span></span><br><span class=\"line\">        factory.connection(ConnectionFactory.PRE);</span><br><span class=\"line\">        <span class=\"comment\">// 线上</span></span><br><span class=\"line\">        factory.connection(ConnectionFactory.PRO);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>输出<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">日常环境连接成功...</span><br><span class=\"line\">预发环境连接成功...</span><br><span class=\"line\">线上环境连接成功...</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n</blockquote>\n<p>这样来编写代码的话，以后如果新加了数据库环境，也只需要新加一个连接类并在在工厂类中添加相关代码即可，而不用去改动其他环境中的代码逻辑。 </p>\n","prev":{"title":"设计模式之代理模式(上) 静态代理与JDK动态代理","slug":"设计模式之代理模式-上-静态代理与JDK动态代理"},"next":{"title":"设计模式之单例模式","slug":"设计模式之单例模式"},"link":"http://wooo.io/post/设计模式之简单工厂模式/","toc":[{"title":"工厂模式","id":"工厂模式","index":"1","children":[{"title":"","id":"简单工厂模式","index":"1.1"}]}]}